<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply â€” {{ scheme.scheme_name }} | BenefitBridge</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --saffron: #FF6B00;
            --saffron-light: #FF8C38;
            --navy: #0A1628;
            --navy-mid: #162035;
            --navy-card: #1C2A40;
            --gold: #F5A623;
            --india-green: #138808;
            --border: rgba(255,255,255,0.08);
        }
        * { box-sizing: border-box; }
        body { font-family: 'DM Sans', sans-serif; background: var(--navy); color: #fff; min-height: 100vh; }

        /* Sidebar (same as dashboard) */
        .sidebar {
            position: fixed; left: 0; top: 0; bottom: 0; width: 220px;
            background: var(--navy-mid); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 1.5rem 1rem; z-index: 100;
        }
        .sidebar-logo { display: flex; align-items: center; gap: 0.6rem; font-family: 'Sora', sans-serif; font-weight: 700; color: #fff; text-decoration: none; margin-bottom: 2.5rem; padding: 0 0.5rem; }
        .logo-dot { width: 30px; height: 30px; border-radius: 8px; background: linear-gradient(135deg, var(--saffron), var(--gold)); display: flex; align-items: center; justify-content: center; font-size: 1rem; }
        .nav-item { display: flex; align-items: center; gap: 0.7rem; padding: 0.65rem 0.75rem; border-radius: 10px; color: rgba(255,255,255,0.5); text-decoration: none; font-size: 0.9rem; transition: all 0.2s; margin-bottom: 0.25rem; }
        .nav-item:hover { background: rgba(255,107,0,0.1); color: #fff; }
        .nav-item i { font-size: 1rem; width: 18px; }
        .nav-spacer { flex: 1; }
        .user-chip { background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 12px; padding: 0.75rem; }
        .user-chip .name { font-size: 0.88rem; font-weight: 600; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .user-chip .email { font-size: 0.75rem; color: rgba(255,255,255,0.35); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Main layout */
        .main { margin-left: 220px; padding: 2rem 2.5rem; min-height: 100vh; }

        /* Back button */
        .btn-back {
            display: inline-flex; align-items: center; gap: 0.4rem;
            color: rgba(255,255,255,0.45); text-decoration: none; font-size: 0.88rem;
            padding: 0.4rem 0.75rem; border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s; margin-bottom: 1.75rem;
        }
        .btn-back:hover { color: #fff; border-color: rgba(255,255,255,0.3); background: rgba(255,255,255,0.04); }

        /* Scheme hero header */
        .scheme-header {
            background: var(--navy-mid);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }
        .scheme-header-top { display: flex; align-items: flex-start; justify-content: space-between; gap: 1rem; flex-wrap: wrap; }
        .scheme-badge {
            display: inline-flex; align-items: center; gap: 0.35rem;
            background: rgba(19,136,8,0.12); border: 1px solid rgba(19,136,8,0.25);
            border-radius: 100px; padding: 0.2rem 0.75rem;
            font-size: 0.72rem; color: #6ee75f; margin-bottom: 0.75rem; width: fit-content;
        }
        .scheme-title { font-family: 'Sora', sans-serif; font-size: 1.5rem; font-weight: 800; margin-bottom: 0.5rem; }
        .scheme-desc { color: rgba(255,255,255,0.5); font-size: 0.92rem; line-height: 1.6; max-width: 600px; }
        .scheme-tags { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 1rem; }
        .tag {
            font-size: 0.75rem; padding: 0.3rem 0.7rem; border-radius: 8px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.5);
        }
        .tag.green { color: #6ee75f; border-color: rgba(110,231,95,0.2); background: rgba(110,231,95,0.05); }
        .tag.gold { color: var(--gold); border-color: rgba(245,166,35,0.2); background: rgba(245,166,35,0.05); }

        /* Benefits highlight */
        .benefits-box {
            background: linear-gradient(135deg, rgba(19,136,8,0.1), rgba(19,136,8,0.04));
            border: 1px solid rgba(19,136,8,0.25);
            border-radius: 12px; padding: 1rem 1.25rem;
            margin-top: 1.25rem;
        }
        .benefits-label { font-size: 0.72rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: #6ee75f; margin-bottom: 0.3rem; }
        .benefits-value { font-family: 'Sora', sans-serif; font-size: 1rem; font-weight: 700; color: #fff; }

        /* Two-column grid */
        .guide-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        @media (max-width: 900px) { .guide-grid { grid-template-columns: 1fr; } }

        /* Cards */
        .guide-card {
            background: var(--navy-card); border: 1px solid var(--border);
            border-radius: 14px; padding: 1.5rem; height: fit-content;
        }
        .guide-card-title {
            font-family: 'Sora', sans-serif; font-size: 0.8rem; font-weight: 700;
            letter-spacing: 0.08em; text-transform: uppercase;
            color: rgba(255,255,255,0.35); margin-bottom: 1.25rem;
            display: flex; align-items: center; gap: 0.5rem;
        }
        .guide-card-title i { font-size: 0.9rem; }

        /* Step list */
        .step-list { list-style: none; padding: 0; margin: 0; }
        .step-item {
            display: flex; gap: 1rem; padding: 0.85rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .step-item:last-child { border-bottom: none; padding-bottom: 0; }
        .step-num {
            width: 28px; height: 28px; border-radius: 50%; flex-shrink: 0;
            background: rgba(255,107,0,0.15); border: 1px solid rgba(255,107,0,0.3);
            display: flex; align-items: center; justify-content: center;
            font-family: 'Sora', sans-serif; font-size: 0.78rem; font-weight: 700;
            color: var(--saffron);
        }
        .step-text { font-size: 0.88rem; color: rgba(255,255,255,0.7); line-height: 1.5; padding-top: 0.2rem; }
        .step-text strong { color: #fff; }

        /* User data panel */
        .data-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.65rem 0; border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.85rem;
        }
        .data-row:last-child { border-bottom: none; }
        .data-label { color: rgba(255,255,255,0.35); font-size: 0.78rem; }
        .data-value { color: #fff; font-weight: 500; text-align: right; }
        .data-value.masked { font-family: monospace; letter-spacing: 0.05em; color: rgba(255,255,255,0.6); }

        /* Copy all button */
        .btn-copy-all {
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            width: 100%; padding: 0.65rem;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 9px; color: rgba(255,255,255,0.6); font-size: 0.83rem;
            cursor: pointer; transition: all 0.2s; margin-top: 1rem;
        }
        .btn-copy-all:hover { background: rgba(255,255,255,0.09); color: #fff; border-color: rgba(255,255,255,0.2); }
        .btn-copy-all.copied { background: rgba(19,136,8,0.12); border-color: rgba(19,136,8,0.3); color: #6ee75f; }

        /* CTA section */
        .cta-section {
            background: var(--navy-mid); border: 1px solid var(--border);
            border-radius: 14px; padding: 1.75rem 2rem;
            display: flex; align-items: center; justify-content: space-between;
            gap: 1.5rem; flex-wrap: wrap; margin-top: 1.5rem;
        }
        .cta-text h3 { font-family: 'Sora', sans-serif; font-size: 1rem; font-weight: 700; margin-bottom: 0.3rem; }
        .cta-text p { color: rgba(255,255,255,0.4); font-size: 0.83rem; margin: 0; }
        .btn-go {
            display: inline-flex; align-items: center; gap: 0.5rem;
            padding: 0.75rem 1.75rem;
            background: var(--india-green); color: #fff;
            border: none; border-radius: 10px;
            font-family: 'Sora', sans-serif; font-weight: 700; font-size: 0.92rem;
            text-decoration: none; transition: all 0.2s; white-space: nowrap;
        }
        .btn-go:hover { background: #0fa806; color: #fff; transform: translateY(-1px); box-shadow: 0 6px 20px rgba(19,136,8,0.3); }
        .btn-go-secondary {
            display: inline-flex; align-items: center; gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: transparent; color: rgba(255,255,255,0.6);
            border: 1px solid rgba(255,255,255,0.15); border-radius: 10px;
            font-size: 0.88rem; text-decoration: none; transition: all 0.2s; white-space: nowrap;
        }
        .btn-go-secondary:hover { border-color: rgba(255,255,255,0.35); color: #fff; }

        /* Notice box */
        .notice {
            background: rgba(245,166,35,0.07); border: 1px solid rgba(245,166,35,0.2);
            border-radius: 10px; padding: 0.85rem 1rem;
            font-size: 0.82rem; color: rgba(245,166,35,0.85);
            display: flex; gap: 0.6rem; align-items: flex-start; margin-top: 1rem;
        }
        .notice i { font-size: 0.9rem; flex-shrink: 0; margin-top: 0.1rem; }

        @media (max-width: 768px) { .sidebar { display: none; } .main { margin-left: 0; padding: 1.5rem 1rem; } }
    </style>
</head>
<body>

<!-- Sidebar -->
<nav class="sidebar">
    <a href="{% url 'home' %}" class="sidebar-logo">
        <div class="logo-dot">ðŸ‡®ðŸ‡³</div>
        BenefitBridge
    </a>
    <a href="{% url 'dashboard' %}" class="nav-item">
        <i class="bi bi-grid-1x2"></i> Dashboard
    </a>
    <a href="{% url 'categories' %}" class="nav-item">
        <i class="bi bi-search"></i> Search Schemes
    </a>
    <div class="nav-spacer"></div>
    <div class="user-chip">
        <div class="name">{{ user.name }}</div>
        <div class="email">{{ user.email }}</div>
        <a href="{% url 'logout' %}" class="nav-item mt-2" style="padding: 0.4rem 0; color: rgba(248,113,113,0.6);">
            <i class="bi bi-box-arrow-right"></i> Sign out
        </a>
    </div>
</nav>

<!-- Main content -->
<main class="main">

    <a href="{% url 'dashboard' %}" class="btn-back">
        <i class="bi bi-arrow-left"></i> Back to Dashboard
    </a>

    <!-- Scheme Header -->
    <div class="scheme-header">
        <div class="scheme-badge"><i class="bi bi-check-circle-fill"></i> You are Eligible</div>
        <div class="scheme-header-top">
            <div>
                <div class="scheme-title">{{ scheme.scheme_name }}</div>
                <div class="scheme-desc">{{ scheme.description }}</div>
                <div class="scheme-tags">
                    {% if scheme.state %}<span class="tag gold"><i class="bi bi-geo-alt-fill"></i> {{ scheme.state }}</span>{% endif %}
                    {% if scheme.benefit_type %}<span class="tag green">{{ scheme.benefit_type }}</span>{% endif %}
                    <span class="tag">Government Scheme</span>
                </div>
            </div>
        </div>
        {% if scheme.benefits %}
        <div class="benefits-box">
            <div class="benefits-label"><i class="bi bi-gift-fill"></i> What You Get</div>
            <div class="benefits-value">{{ scheme.benefits }}</div>
        </div>
        {% endif %}
    </div>

    <!-- Two-column guide -->
    <div class="guide-grid">

        <!-- LEFT: How to Apply Steps -->
        <div class="guide-card">
            <div class="guide-card-title">
                <i class="bi bi-list-ol"></i> How to Apply â€” Step by Step
            </div>
            <ol class="step-list">
                <li class="step-item">
                    <div class="step-num">1</div>
                    <div class="step-text">
                        <strong>Copy your details</strong> from the panel on the right. Keep this tab open â€” you'll need them to fill the form.
                    </div>
                </li>
                <li class="step-item">
                    <div class="step-num">2</div>
                    <div class="step-text">
                        Click <strong>"Go to Official Portal"</strong> below to open the government website in a new tab.
                    </div>
                </li>
                <li class="step-item">
                    <div class="step-num">3</div>
                    <div class="step-text">
                        <strong>Register / Log in</strong> on the portal using your Aadhaar number or mobile number linked to Aadhaar.
                    </div>
                </li>
                <li class="step-item">
                    <div class="step-num">4</div>
                    <div class="step-text">
                        Look for <strong>"New Application" or "Apply Now"</strong> on the portal. Select the relevant scheme if prompted.
                    </div>
                </li>
                <li class="step-item">
                    <div class="step-num">5</div>
                    <div class="step-text">
                        Fill in your <strong>personal details</strong> (name, DOB, Aadhaar, income, address) using the data from the right panel.
                    </div>
                </li>
                <li class="step-item">
                    <div class="step-num">6</div>
                    <div class="step-text">
                        <strong>Upload documents</strong> â€” typically: Aadhaar card, income certificate, bank passbook, and a passport-size photo.
                    </div>
                </li>
                <li class="step-item">
                    <div class="step-num">7</div>
                    <div class="step-text">
                        <strong>Submit</strong> the form and note your application reference number for future tracking.
                    </div>
                </li>
            </ol>

            <div class="notice">
                <i class="bi bi-info-circle-fill"></i>
                Government portals may ask you to verify via OTP sent to your Aadhaar-linked mobile number. Keep your phone nearby.
            </div>
        </div>

        <!-- RIGHT: Your Pre-filled Details -->
        <div>
            <div class="guide-card">
                <div class="guide-card-title">
                    <i class="bi bi-person-vcard"></i> Your Details â€” Ready to Fill
                </div>

                <div class="data-row">
                    <span class="data-label">Full Name</span>
                    <span class="data-value" id="val-name">{{ user.name }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Date of Birth</span>
                    <span class="data-value">{{ user.dob|date:"d/m/Y" }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Gender</span>
                    <span class="data-value">{{ user.gender|default:"â€”" }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Email</span>
                    <span class="data-value">{{ user.email|default:"â€”" }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Phone</span>
                    <span class="data-value">{{ user.phone|default:"â€”" }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Aadhaar No.</span>
                    <span class="data-value masked" id="val-aadhaar">{{ user.aadhaar_no }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Address</span>
                    <span class="data-value" style="max-width:55%;text-align:right;">{{ user.address|default:"â€”" }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Annual Income</span>
                    <span class="data-value">
                        {% if user.income %}â‚¹{{ user.income|floatformat:0 }}{% else %}â€”{% endif %}
                    </span>
                </div>
                <div class="data-row">
                    <span class="data-label">Occupation</span>
                    <span class="data-value">{{ user.occupation|default:"â€”" }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Education</span>
                    <span class="data-value">{{ user.education|default:"â€”" }}</span>
                </div>

                <button class="btn-copy-all" id="copyAllBtn" onclick="copyAllDetails()">
                    <i class="bi bi-clipboard"></i> Copy All Details
                </button>

                <div class="notice" style="margin-top:0.75rem;">
                    <i class="bi bi-shield-check"></i>
                    Your data is only shown here to help you fill the form. Nothing is sent automatically.
                </div>
            </div>
        </div>
    </div>

    <!-- CTA: Go to Portal -->
    <div class="cta-section">
        <div class="cta-text">
            <h3>Ready to apply?</h3>
            <p>The official government portal will open in a new tab. Keep this page open for your details.</p>
        </div>
        <div class="d-flex gap-2 flex-wrap">
            {% if apply_url %}
                <a href="{{ apply_url }}" target="_blank" rel="noopener" class="btn-go">
                    Go to Official Portal <i class="bi bi-box-arrow-up-right"></i>
                </a>
            {% endif %}
            {% if scheme.official_link and scheme.official_link != apply_url %}
                <a href="{{ scheme.official_link }}" target="_blank" rel="noopener" class="btn-go-secondary">
                    Scheme Homepage <i class="bi bi-globe"></i>
                </a>
            {% endif %}
            {% if not apply_url %}
                <div class="notice" style="margin:0;">
                    <i class="bi bi-exclamation-circle"></i>
                    Direct link not available. Please search for "{{ scheme.scheme_name }}" on the official government website.
                </div>
            {% endif %}
        </div>
    </div>

</main>

<script>
function copyAllDetails() {
    const details = `Name: {{ user.name }}
Date of Birth: {{ user.dob|date:"d/m/Y" }}
Gender: {{ user.gender|default:"â€”" }}
Email: {{ user.email|default:"â€”" }}
Phone: {{ user.phone|default:"â€”" }}
Aadhaar No: {{ user.aadhaar_no }}
Address: {{ user.address|default:"â€”" }}
Annual Income: {% if user.income %}â‚¹{{ user.income|floatformat:0 }}{% else %}â€”{% endif %}
Occupation: {{ user.occupation|default:"â€”" }}
Education: {{ user.education|default:"â€”" }}`;

    navigator.clipboard.writeText(details).then(function() {
        var btn = document.getElementById('copyAllBtn');
        btn.classList.add('copied');
        btn.innerHTML = '<i class="bi bi-check2-circle"></i> Copied!';
        setTimeout(function() {
            btn.classList.remove('copied');
            btn.innerHTML = '<i class="bi bi-clipboard"></i> Copy All Details';
        }, 2500);
    }).catch(function() {
        alert('Copy failed. Please manually select and copy your details.');
    });
}
</script>

</body>
</html>